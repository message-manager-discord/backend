generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}


model Channel {
  id              BigInt             @id
  permissions Json? 
  webhookId       BigInt?
  webhookToken    String?            @db.VarChar(255) /// @encrypted
  guildId     BigInt
  guild Guild   @relation(fields: [guildId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  messages Message[]
  
}


model Guild {
  id                 BigInt             @id
  logChannelId      BigInt?
  permissions Json? 
  messages Message[]
  channels Channel[]
}

model Message {
  id BigInt  @unique
  guildId BigInt
  guild Guild @relation(fields: [guildId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  channelId BigInt
  channel Channel @relation(fields: [channelId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  content String /// @encrypted
  lastEditedAt DateTime
  tags String[]

}

model MessageHistory {
  id BigInt  
  guildId BigInt
  channelId BigInt
  newContent String /// @encrypted
  editedBy BigInt
  editedAt DateTime
  tags String[]
  @@unique([id, editedAt])
}

model User {
  id              BigInt             @id
  oauthToken String? /// @encrypted
  oauthTokenExpiration DateTime?
  refreshToken String? /// @encrypted
  staff Boolean @default(false)
}